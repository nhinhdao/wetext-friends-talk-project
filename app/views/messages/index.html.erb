
<% if flash[:message] %>
    <div class="alert alert-success"><%= flash[:message] %></div>
<% elsif flash[:warning] %>
    <div class="alert alert-danger"><%= flash[:warning] %></div>
<% end %>

<h1>Messages</h1>
<hr>
<%# add  id="defaultOpen" to open a chat by default %>

<%# left pane: display avatar and email of a friend %>
<div class="row">
  <div class="col-md-1">
    <table class="table table-striped">
      <thead></thead>
      <tbody>
          <% @uniq_users.each do |user|  %>
          <tr>
            <td class="choice text-center" onclick="openMessage(this)" data-friend="<%= user.id %>" data-user="<%= session[:current_user_id] %>"><img src="<%= user.image %>" style="width: 50px">
            <%# binding.pry; %>
            <%= user.username  %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="col-sm-1"></div>
  <%# right pane: display chats between the selected friend and current_user %>
  <div class="col-md-9">
      <div class="row popup message">
        <img src="" alt="Avatar" style="width:50px;">
        <p class='received'></p>
        <span class="time-left"></span>
      </div>

      <div class="row popup darker">
        <img src="" alt="Avatar" class="right" style="width:50px;">
        <p class="sent time-right"></p>
        <span class="time-right"></span>
    </div>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
function openMessage(td) {
  let user_id = parseInt(td.dataset.user);
  let friend_id = parseInt(td.dataset.friend);
  let ids = [user_id, friend_id];
  $.get('users/'+${user_id}+'/messages/'+${friend_id}, function (message) {
    debugger;
    var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(cityName).style.display = "block";
      evt.currentTarget.className += " active";
    })
  }
// Get the element with id="defaultOpen" and click on it
// document.getElementById("defaultOpen").click();
</script>